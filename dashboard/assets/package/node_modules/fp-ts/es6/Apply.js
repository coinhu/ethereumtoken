import { tuple } from './function';
function curried(f, n, acc) {
    return function (x) {
        const combined = acc.concat([x]);
        return n === 0 ? f.apply(null, combined) : curried(f, n - 1, combined);
    };
}
const tupleConstructors = {};
function getTupleConstructor(len) {
    if (!tupleConstructors.hasOwnProperty(len)) {
        tupleConstructors[len] = curried(tuple, len - 1, []);
    }
    return tupleConstructors[len];
}
export function sequenceT(F) {
    return (...args) => {
        const len = args.length;
        const f = getTupleConstructor(len);
        let fas = F.map(args[0], f);
        for (let i = 1; i < len; i++) {
            fas = F.ap(fas, args[i]);
        }
        return fas;
    };
}
function getRecordConstructor(keys) {
    const len = keys.length;
    return curried((...args) => {
        const r = {};
        for (let i = 0; i < len; i++) {
            r[keys[i]] = args[i];
        }
        return r;
    }, len - 1, []);
}
export function sequenceS(F) {
    return r => {
        const keys = Object.keys(r);
        const len = keys.length;
        const f = getRecordConstructor(keys);
        let fr = F.map(r[keys[0]], f);
        for (let i = 1; i < len; i++) {
            fr = F.ap(fr, r[keys[i]]);
        }
        return fr;
    };
}
